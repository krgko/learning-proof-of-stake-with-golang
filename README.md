# Learning Proof of Stake with Golang

## Command

```bash
go build -o app && ./app
```

## Result

```bash
❯ go build -o app && ./app

Round: 0
        Address: 7b5f3abda9a35cd82240aff4998e8af9 -Stake: 40
        Address: 81780f4d29fd43f5384fef887aa4c25b -Stake: 61
Round: 1
        Address: 7b5f3abda9a35cd82240aff4998e8af9 -Stake: 40
        Address: 81780f4d29fd43f5384fef887aa4c25b -Stake: 62
Round: 2
        Address: 7b5f3abda9a35cd82240aff4998e8af9 -Stake: 40
        Address: 81780f4d29fd43f5384fef887aa4c25b -Stake: 63
Round: 3
        Address: 7b5f3abda9a35cd82240aff4998e8af9 -Stake: 41
        Address: 81780f4d29fd43f5384fef887aa4c25b -Stake: 63
Round: 4
        Address: 7b5f3abda9a35cd82240aff4998e8af9 -Stake: 41
        Address: 81780f4d29fd43f5384fef887aa4c25b -Stake: 64
Round: 5
        Address: 7b5f3abda9a35cd82240aff4998e8af9 -Stake: 41
        Address: 81780f4d29fd43f5384fef887aa4c25b -Stake: 65
Round: 6
        Address: 7b5f3abda9a35cd82240aff4998e8af9 -Stake: 42
        Address: 81780f4d29fd43f5384fef887aa4c25b -Stake: 65
Round: 7
        Address: 7b5f3abda9a35cd82240aff4998e8af9 -Stake: 42
        Address: 81780f4d29fd43f5384fef887aa4c25b -Stake: 66
Round: 8
        Address: 7b5f3abda9a35cd82240aff4998e8af9 -Stake: 42
        Address: 81780f4d29fd43f5384fef887aa4c25b -Stake: 67
Round: 9
        Address: 7b5f3abda9a35cd82240aff4998e8af9 -Stake: 42
        Address: 81780f4d29fd43f5384fef887aa4c25b -Stake: 68
Block 0 Info:
        Timestamp: 2022-12-19 03:10:46.263995 +0700 +07 m=+0.000091767
        Previous Hash:
        Hash: a517860f66fc4eb6a8d21cd7481156395d9805bcc4e1d410e3d0906c7308c06c
        Validator Address:
Block 1 Info:
        Timestamp: 2022-12-19 03:10:46.264159 +0700 +07 m=+0.000255858
        Previous Hash: a517860f66fc4eb6a8d21cd7481156395d9805bcc4e1d410e3d0906c7308c06c
        Hash: 35740e5581525552736fd29aeff4376269a6c2d51420fb8d2fe13dc80c5c058d
        Validator Address: 81780f4d29fd43f5384fef887aa4c25b
Block 2 Info:
        Timestamp: 2022-12-19 03:10:46.264181 +0700 +07 m=+0.000276990
        Previous Hash: 35740e5581525552736fd29aeff4376269a6c2d51420fb8d2fe13dc80c5c058d
        Hash: f65c819001ce79062cea4216d9dd54f9512cbab804f1225594f3ca8ac0f51f84
        Validator Address: 81780f4d29fd43f5384fef887aa4c25b
Block 3 Info:
        Timestamp: 2022-12-19 03:10:46.264193 +0700 +07 m=+0.000289041
        Previous Hash: f65c819001ce79062cea4216d9dd54f9512cbab804f1225594f3ca8ac0f51f84
        Hash: 536022e8c83c2b6d5b62c076328341011baa3f8090aa543185679bf27ad6d569
        Validator Address: 81780f4d29fd43f5384fef887aa4c25b
Block 4 Info:
        Timestamp: 2022-12-19 03:10:46.264202 +0700 +07 m=+0.000298783
        Previous Hash: 536022e8c83c2b6d5b62c076328341011baa3f8090aa543185679bf27ad6d569
        Hash: 063b305d414fd557d9be7ba8668dbc2ee40dad5e15058bb9e42a0e6e99a53bf8
        Validator Address: 7b5f3abda9a35cd82240aff4998e8af9
Block 5 Info:
        Timestamp: 2022-12-19 03:10:46.264214 +0700 +07 m=+0.000309950
        Previous Hash: 063b305d414fd557d9be7ba8668dbc2ee40dad5e15058bb9e42a0e6e99a53bf8
        Hash: c72ff70c9a55b50c14310171d0ae1df284228c6eb76287281317c31d44e977eb
        Validator Address: 81780f4d29fd43f5384fef887aa4c25b
Block 6 Info:
        Timestamp: 2022-12-19 03:10:46.264226 +0700 +07 m=+0.000322010
        Previous Hash: c72ff70c9a55b50c14310171d0ae1df284228c6eb76287281317c31d44e977eb
        Hash: 98ac50f693346198be7865b10162bad0a37e90bd3c5d87d4623a9d41e3cd878e
        Validator Address: 81780f4d29fd43f5384fef887aa4c25b
Block 7 Info:
        Timestamp: 2022-12-19 03:10:46.264242 +0700 +07 m=+0.000338106
        Previous Hash: 98ac50f693346198be7865b10162bad0a37e90bd3c5d87d4623a9d41e3cd878e
        Hash: 40831715d53947c9f84aaec8804148ff2f1aff90f5603d3a40ec518464e8e3ec
        Validator Address: 7b5f3abda9a35cd82240aff4998e8af9
Block 8 Info:
        Timestamp: 2022-12-19 03:10:46.264255 +0700 +07 m=+0.000351645
        Previous Hash: 40831715d53947c9f84aaec8804148ff2f1aff90f5603d3a40ec518464e8e3ec
        Hash: cfe0d4a035589ba181ab44128ba62baa68163765d30fde1eb5c737c5b7296f7e
        Validator Address: 81780f4d29fd43f5384fef887aa4c25b
Block 9 Info:
        Timestamp: 2022-12-19 03:10:46.264273 +0700 +07 m=+0.000369635
        Previous Hash: cfe0d4a035589ba181ab44128ba62baa68163765d30fde1eb5c737c5b7296f7e
        Hash: 380e515d96a41a03b00ed5fff0a4c1b560f4d6ceef3bb1adc20f2aaaff3cfa35
        Validator Address: 81780f4d29fd43f5384fef887aa4c25b
Block 10 Info:
        Timestamp: 2022-12-19 03:10:46.264294 +0700 +07 m=+0.000390381
        Previous Hash: 380e515d96a41a03b00ed5fff0a4c1b560f4d6ceef3bb1adc20f2aaaff3cfa35
        Hash: 8252c4a28e8bc31453a7bb2428cd89620bd7f850e417f7ccaebea5e936cec8f7
        Validator Address: 81780f4d29fd43f5384fef887aa4c25b
```

## References

- [Build your own proof of stake](https://kbtg.udemy.com/course/build-your-own-proof-of-stake-blockchain/learn/lecture/23354034#overview)
  - This one might useful for Python implementation. He used lib `p2pnetwork` to implement P2P network, and he also used forger concept and lots. This source code can be found at [just-g-gdrive](https://drive.google.com/file/d/1agTPzGDby1hrorDegnybYfjGUjnLGNo-/view?usp=share_link)
    - He is not encode public key into some form of an address.
    - lots: staker public keys
    - forger: to select the winner lot by create a new offset to be a winner lot -> the winner lot public key. To use is just repeat forger process like elect for the winner.
    - typically, the PoS should weight the block producer from their vesting. That's mean more vested, more chance.
    - to sync data from one to another node, just send encoded data to node that request via P2P protocol.
    - [p2pNetworkLib](https://pypi.org/project/p2pnetwork/)
- [Proof of stake in Blockchain - Forger](https://medium.com/techskill-brew/proof-of-stake-or-pos-in-blockchain-part-8-blockchain-basics-32d461232e1c)

  - Forging and Forger: Block is considered to be forged or minted instead of mined.
  - How to select validators?

    - Node wealth: more weight, more chance
    - Coin age: how long their coins at stake with the number of days?
    - Randomize block selection: a node with a hit value below the target value is selected for the next block.

      ```bash
      T = Tb * S * Se

      Tb = the base target value calc by multiple of block's target value and amount of time that required to forge that block
      S = time in seconds
      Se = coin at stake
      ```

    - How does PoS works?
      1. A validator must stake
      2. Validators are selected in a pseudo-random depending on their wealth
      3. When a node gets chosen to forge the next block, check the transactions in the block are valid. The validators verify for double-spending then the group of verified hash transactions would push into a Merkle tree with one root hash.
      4. After verifying the transactions, the forger signs the block and broadcast it on the network. Other else that does not chosen are called attestors to cross verify the transactions such the block is valid and it signed by a valid forger.
      5. **Time in PoS is divided into slots and epochs**. One slot is the time set to create a block e.g., ETH2.0 one slot is of 12 secs. 32 slots make up an epoch, thus one epoch is 6.4 mins (32 \* 12 = 384; 384/60 = 6.4 mins). **Each slot represent the possibility for the block to be added to the Blockchain.** If forger misses an assigned duty, a slot may be empty.
      6. After the block has been validated and added to the Blockchain, the node who got the chance to forge the block gets a reward. As a reward, the forger receives the transaction fees. The attestors also get rewarded for making correct attestations.

  - Nothing at stake: a validators decide to forge on 2 chains (forked). It can increase chances of double-spending. to prevent this issue, add some punishments like freeze a validator, slash a validator, etc.
  - Casper: on Ethereum, the validators will be penaltized if they are do fraudance activity like slashing their stakes.

- [Build proof of stake in Golang](https://levelup.gitconnected.com/build-a-proof-of-stake-blockchain-in-go-a765cb217d35)
  - PoW vs PoS
    - PoW: mine, 51% Atk, less capital for validators, powerful miner or majority is king.
    - PoS: mint/forge, Nothing at Stake, more capital for validators, wealthy validator is king.
  - Improvements
    - [] Unit tests
    - [] Concurrency
    - [] Decentralization -> Multiple machine
    - [] Refactoring
    - [] Weighting
    - [] Tokenization -> Block reward adjustment
    - [] Smart Contract
